--Elimino pedidos de fleet
update UNIGIS_DataRepository.dbo.Pedido set Eliminado = 1, FechaEliminacion = GETDATE() where ReferenciaExterna in
(
'1355494',
'1355501',
'1355644',
'1355650',
'1355721',
'1355725',
'1355742',
'1355743',
'1355744',
'1355803',
'1355895',
'1355897',
'1355935',
'1356021',
'1356102',
'1356191',
'1356325',
'1356352',
'1357260',
'1357300',
'1357444',
'1357447',
'1357534',
'1357542',
'1357650',
'1357651',
'1357652',
'1357658',
'1357673',
'1357677',
'1357751',
'1357943',
'1357949',
'1358098',
'1358139',
'1358142',
'1358374',
'1358534',
'1358579',
'1358580',
'1358692',
'1358693'
)
and idcliente = 2757 --(filtrar por el id del cliente )


--Reprocesar dede Portal con los nuevos datos, que serían sin iddeliveryadresses2 en null(la que "iría" al expreso), el C_DIFFERENTDELIVERYADDRESS en 0 ya que es entrega punto a punto 
--ORDERTYPETMS = 1 ya que es pedido tipo distribución estandar. 
update [3PL_POOL].dbo.pl_orders set ID_DELIVERYADDRESS2 = null, C_DIFFERENTDELIVERYADDRESS = 0, STATUS = 3, SENDTOFLEET = null , ORDERTYPETMS = 1 where EXTERNORDERKEY in
(
'1355494',
'1355501',
'1355644',
'1355650',
'1355721',
'1355725',
'1355742',
'1355743',
'1355744',
'1355803',
'1355895',
'1355897',
'1355935',
'1356021',
'1356102',
'1356191',
'1356325',
'1356352',
'1357260',
'1357300',
'1357444',
'1357447',
'1357534',
'1357542',
'1357650',
'1357651',
'1357652',
'1357658',
'1357673',
'1357677',
'1357751',
'1357943',
'1357949',
'1358098',
'1358139',
'1358142',
'1358374',
'1358534',
'1358579',
'1358580',
'1358692',
'1358693'
)
and IDCUSTOMER = 3158 --(filtrar por el id del cliente ) 



--Verificamos que se vayan reprocesando los pedidos
select SUSPENDINDICATOR,ID_DELIVERYADDRESS2,C_DIFFERENTDELIVERYADDRESS, status, EXTERNORDERKEY, SENDTOFLEET, ORDERTYPETMS, * from [3PL_POOL].dbo.pl_orders where EXTERNORDERKEY in
(
'1355494',
'1355501',
'1355644',
'1355650',
'1355721',
'1355725',
'1355742',
'1355743',
'1355744',
'1355803',
'1355895',
'1355897',
'1355935',
'1356021',
'1356102',
'1356191',
'1356325',
'1356352',
'1357260',
'1357300',
'1357444',
'1357447',
'1357534',
'1357542',
'1357650',
'1357651',
'1357652',
'1357658',
'1357673',
'1357677',
'1357751',
'1357943',
'1357949',
'1358098',
'1358139',
'1358142',
'1358374',
'1358534',
'1358579',
'1358580',
'1358692',
'1358693'
)
and SENDTOFLEET is null
and IDCUSTOMER = 3158--(filtrar por el id del cliente )


--Tiramos dropid desde infor
UPDATE SCMC2_LNK.SCMC1.wmwhse2.TRANSMITLOG SET TRANSMITFLAG3 = 0 WHERE KEY1 IN (
select ORDERKEY from SCMC2_LNK.SCMC1.wmwhse2.orders where EXTERNORDERKEY in
(
'1355494',
'1355501',
'1355644',
'1355650',
'1355721',
'1355725',
'1355742',
'1355743',
'1355744',
'1355803',
'1355895',
'1355897',
'1355935',
'1356021',
'1356102',
'1356191',
'1356325',
'1356352',
'1357260',
'1357300',
'1357444',
'1357447',
'1357534',
'1357542',
'1357650',
'1357651',
'1357652',
'1357658',
'1357673',
'1357677',
'1357751',
'1357943',
'1357949',
'1358098',
'1358139',
'1358142',
'1358374',
'1358534',
'1358579',
'1358580',
'1358692',
'1358693'
)
)AND TABLENAME = 'customerorderstaged'




--Verificamos el flujo mientras se reprocesa
SELECT * FROM SCMC2_LNK.SCMC1.wmwhse2.TRANSMITLOG WHERE KEY1 IN (
select ORDERKEY from SCMC2_LNK.SCMC1.wmwhse2.orders where EXTERNORDERKEY in
(
'1355494',
'1355501',
'1355644',
'1355650',
'1355721',
'1355725',
'1355742',
'1355743',
'1355744',
'1355803',
'1355895',
'1355897',
'1355935',
'1356021',
'1356102',
'1356191',
'1356325',
'1356352',
'1357260',
'1357300',
'1357444',
'1357447',
'1357534',
'1357542',
'1357650',
'1357651',
'1357652',
'1357658',
'1357673',
'1357677',
'1357751',
'1357943',
'1357949',
'1358098',
'1358139',
'1358142',
'1358374',
'1358534',
'1358579',
'1358580',
'1358692',
'1358693'
)
)
AND TABLENAME = 'customerorderstaged'
AND TRANSMITFLAG3 = 0